<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - E-Learning Portal</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="admin-container">
        <header class="admin-header">
            <h1>Admin Dashboard</h1>
            <div class="admin-nav">
                <a href="index.html" class="nav-link">View Portal</a>
                <a href="admin-login.html" class="nav-link logout">Logout</a>
            </div>
        </header>

        <div class="admin-content">
            <div class="admin-tabs">
                <button class="tab-btn active" data-tab="lessons">Manage Lessons</button>
                <button class="tab-btn" data-tab="questions">Manage Questions</button>
            </div>

            <!-- Lessons Management Tab -->
            <div id="lessons-tab" class="tab-content active">
                <div class="admin-section">
                    <h2>Add New Lesson</h2>
                    <form id="addLessonForm" class="admin-form">
                        <div class="form-group">
                            <label for="lessonTitle">Lesson Title</label>
                            <input type="text" id="lessonTitle" required placeholder="Enter lesson title">
                        </div>
                        <div class="form-group">
                            <label for="lessonContent">Lesson Content</label>
                            <textarea id="lessonContent" rows="6" required placeholder="Enter lesson content"></textarea>
                        </div>
                        <button type="submit" class="admin-btn">Add Lesson</button>
                    </form>
                </div>

                <div class="admin-section">
                    <h2>Existing Lessons</h2>
                    <div id="lessonsList" class="items-list">
                        <div class="loading-spinner">
                            <div class="spinner"></div>
                            <p>Loading lessons...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Questions Management Tab -->
            <div id="questions-tab" class="tab-content">
                <div class="admin-section">
                    <h2>Add New Question</h2>
                    <form id="addQuestionForm" class="admin-form">
                        <div class="form-group">
                            <label for="questionText">Question</label>
                            <textarea id="questionText" rows="3" required placeholder="Enter the question"></textarea>
                        </div>
                        <div class="form-group">
                            <label>Answer Options</label>
                            <input type="text" id="optionA" required placeholder="Option A">
                            <input type="text" id="optionB" required placeholder="Option B">
                            <input type="text" id="optionC" required placeholder="Option C">
                            <input type="text" id="optionD" required placeholder="Option D">
                        </div>
                        <div class="form-group">
                            <label for="correctAnswer">Correct Answer</label>
                            <select id="correctAnswer" required>
                                <option value="">Select correct answer</option>
                                <option value="0">Option A</option>
                                <option value="1">Option B</option>
                                <option value="2">Option C</option>
                                <option value="3">Option D</option>
                            </select>
                        </div>
                        <button type="submit" class="admin-btn">Add Question</button>
                    </form>
                </div>

                <div class="admin-section">
                    <h2>Existing Questions</h2>
                    <div id="questionsList" class="items-list">
                        <div class="loading-spinner">
                            <div class="spinner"></div>
                            <p>Loading questions...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="adminMessage" class="admin-message" style="display: none;"></div>
    </div>

    <script>
        // Admin Dashboard functionality
        let lessonsData = [];
        let questionsData = [];

        document.addEventListener('DOMContentLoaded', function() {
            initializeAdminDashboard();
        });

        function initializeAdminDashboard() {
            setupTabNavigation();
            setupForms();
            loadContent();
        }

        function setupTabNavigation() {
            const tabBtns = document.querySelectorAll('.tab-btn');
            const tabContents = document.querySelectorAll('.tab-content');

            tabBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const tabId = this.dataset.tab;
                    
                    // Update active tab button
                    tabBtns.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');

                    // Update active tab content
                    tabContents.forEach(content => {
                        if (content.id === `${tabId}-tab`) {
                            content.classList.add('active');
                        } else {
                            content.classList.remove('active');
                        }
                    });
                });
            });
        }

        function setupForms() {
            // Add Lesson Form
            document.getElementById('addLessonForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const title = document.getElementById('lessonTitle').value;
                const content = document.getElementById('lessonContent').value;

                try {
                    const response = await fetch('/api/lessons', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ title, content })
                    });

                    if (response.ok) {
                        showMessage('Lesson added successfully!', 'success');
                        this.reset();
                        loadLessons();
                    } else {
                        const error = await response.json();
                        showMessage(error.message || 'Failed to add lesson', 'error');
                    }
                } catch (error) {
                    console.error('Error adding lesson:', error);
                    showMessage('Connection error. Please try again.', 'error');
                }
            });

            // Add Question Form
            document.getElementById('addQuestionForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const questionText = document.getElementById('questionText').value;
                const options = [
                    document.getElementById('optionA').value,
                    document.getElementById('optionB').value,
                    document.getElementById('optionC').value,
                    document.getElementById('optionD').value
                ];
                const correct = parseInt(document.getElementById('correctAnswer').value);

                try {
                    const response = await fetch('/api/questions', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            question: questionText,
                            options,
                            correct
                        })
                    });

                    if (response.ok) {
                        showMessage('Question added successfully!', 'success');
                        this.reset();
                        loadQuestions();
                    } else {
                        const error = await response.json();
                        showMessage(error.message || 'Failed to add question', 'error');
                    }
                } catch (error) {
                    console.error('Error adding question:', error);
                    showMessage('Connection error. Please try again.', 'error');
                }
            });
        }

        async function loadContent() {
            await Promise.all([loadLessons(), loadQuestions()]);
        }

        async function loadLessons() {
            try {
                const response = await fetch('/api/content');
                const data = await response.json();
                
                if (response.ok) {
                    lessonsData = data.lessons;
                    renderLessons();
                } else {
                    showMessage('Failed to load lessons', 'error');
                }
            } catch (error) {
                console.error('Error loading lessons:', error);
                showMessage('Connection error loading lessons', 'error');
            }
        }

        async function loadQuestions() {
            try {
                const response = await fetch('/api/content');
                const data = await response.json();
                
                if (response.ok) {
                    questionsData = data.questions;
                    renderQuestions();
                } else {
                    showMessage('Failed to load questions', 'error');
                }
            } catch (error) {
                console.error('Error loading questions:', error);
                showMessage('Connection error loading questions', 'error');
            }
        }

        function renderLessons() {
            const lessonsList = document.getElementById('lessonsList');
            
            if (lessonsData.length === 0) {
                lessonsList.innerHTML = '<p class="empty-state">No lessons found. Add your first lesson above.</p>';
                return;
            }

            const lessonsHTML = lessonsData.map(lesson => `
                <div class="item-card">
                    <div class="item-header">
                        <h3>${lesson.title}</h3>
                        <button class="delete-btn" onclick="deleteLesson(${lesson.id})">Remove</button>
                    </div>
                    <div class="item-content">
                        <p>${lesson.content.substring(0, 150)}${lesson.content.length > 150 ? '...' : ''}</p>
                    </div>
                </div>
            `).join('');

            lessonsList.innerHTML = lessonsHTML;
        }

        function renderQuestions() {
            const questionsList = document.getElementById('questionsList');
            
            if (questionsData.length === 0) {
                questionsList.innerHTML = '<p class="empty-state">No questions found. Add your first question above.</p>';
                return;
            }

            const questionsHTML = questionsData.map(q => `
                <div class="item-card">
                    <div class="item-header">
                        <h3>Question ${q.id}</h3>
                        <button class="delete-btn" onclick="deleteQuestion(${q.id})">Remove</button>
                    </div>
                    <div class="item-content">
                        <p><strong>Q:</strong> ${q.question}</p>
                        <div class="options-preview">
                            ${q.options.map((opt, idx) => `
                                <span class="option ${idx === q.correct ? 'correct' : ''}">${String.fromCharCode(65 + idx)}. ${opt}</span>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `).join('');

            questionsList.innerHTML = questionsHTML;
        }

        async function deleteLesson(id) {
            if (!confirm('Are you sure you want to delete this lesson?')) return;

            try {
                const response = await fetch(`/api/lessons/${id}`, {
                    method: 'DELETE'
                });

                if (response.ok) {
                    showMessage('Lesson deleted successfully!', 'success');
                    loadLessons();
                } else {
                    const error = await response.json();
                    showMessage(error.message || 'Failed to delete lesson', 'error');
                }
            } catch (error) {
                console.error('Error deleting lesson:', error);
                showMessage('Connection error. Please try again.', 'error');
            }
        }

        async function deleteQuestion(id) {
            if (!confirm('Are you sure you want to delete this question?')) return;

            try {
                const response = await fetch(`/api/questions/${id}`, {
                    method: 'DELETE'
                });

                if (response.ok) {
                    showMessage('Question deleted successfully!', 'success');
                    loadQuestions();
                } else {
                    const error = await response.json();
                    showMessage(error.message || 'Failed to delete question', 'error');
                }
            } catch (error) {
                console.error('Error deleting question:', error);
                showMessage('Connection error. Please try again.', 'error');
            }
        }

        function showMessage(text, type) {
            const messageElement = document.getElementById('adminMessage');
            messageElement.textContent = text;
            messageElement.className = `admin-message ${type}`;
            messageElement.style.display = 'block';
            
            // Hide message after 3 seconds
            setTimeout(() => {
                messageElement.style.display = 'none';
            }, 3000);
        }
    </script>
</body>
</html>